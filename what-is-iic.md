# IIC I2C是什麼

I2C（Inter-Integrated Circuit）是一種串行通訊協議，廣泛用於微控制器與各種感測器、顯示器或其他裝置之間的通訊。它由Philips Semiconductor（現在的NXP Semiconductors）在1980年代初開發，是一種極受歡迎的通訊協議，因其簡單性和效率而被廣泛應用於嵌入式系統中。

:::info
:bulb: I2C常被讀作「I-squared-C」（I平方C）或簡單地稱為「I-two-C」（I兩C）。
:::

{%youtube 6IAkYpmA1DQ %} 

## I2C 的主要特點

- **兩線制介面**：
I2C只需要兩條線：一條串行數據線（SDA）和一條串行時鐘線（SCL）。這種設計使得物理連接變得簡單，並有助於降低系統的成本和復雜性。

- **多主設備支持**：
I2C允許多個主設備（發起通訊的裝置）和多個從設備（響應通訊的裝置）連接到同一線路上，而無需額外的地址線。每個裝置都有一個唯一的地址。

- **同步通訊**：
數據傳輸是由時鐘信號控制的，這意味著發送數據和時鐘信號同步進行，確保數據的穩定性和可靠性。

- **可擴展的數據傳輸速率**：
I2C支持多種數據傳輸速率，從標準模式的100kbps到高速模式的3.4Mbps不等，使其適用於不同的應用需求。

## I2C 通訊原理

I2C協議基於主從架構，通訊過程包含以下關鍵元素：

### 1. 起始和終止條件

- **起始條件(START)**：當SCL為高電平時，SDA從高電平切換到低電平。
- **終止條件(STOP)**：當SCL為高電平時，SDA從低電平切換到高電平。

### 2. 數據傳輸

- 數據以8位（1位元組）為單位傳輸
- 傳輸從最高有效位（MSB）開始
- 每傳輸完1位元組後，接收方需發送一個應答位（ACK或NACK）

### 3. 尋址機制

- 標準I2C協議使用7位地址，擴展可使用10位地址
- 地址後跟一個讀/寫位元，指示操作類型

:::warning
:zap: 注意：I2C總線有上拉電阻要求，通常需要在SDA和SCL線上各加一個上拉電阻（典型值為4.7kΩ）。
:::

## I2C 接線範例

對於Arduino等微控制器平台的新手，以下是I2C連接的典型示例：

```
主設備 (如Arduino)     從設備 (如感測器)
-------------         -------------
   SDA    ----------->    SDA
   SCL    ----------->    SCL
   GND    ----------->    GND
   VCC    ----------->    VCC
```

![I2C連接示意圖](https://i.imgur.com/YLDfHJm.png)

## 常見I2C通訊問題及解決方案

| 問題 | 可能原因 | 解決方案 |
|:-----|:---------|:---------|
| 無法檢測到設備 | 地址錯誤或連接問題 | 使用I2C掃描器確認地址，檢查電源和接線 |
| 通訊不穩定 | 干擾或上拉電阻不當 | 確保短距離連接，調整上拉電阻值 |
| 多設備衝突 | 地址衝突 | 確保每個設備有唯一地址，可使用地址轉換器 |
| 時序問題 | 高速通訊不兼容 | 降低通訊速率，確保配置正確 |


## I2C 在 Meshtastic 中的應用

在 Meshtastic 項目中，I2C 介面被用於連接各種外部裝置和感測器，如：

- **氣壓計**：
用於測量氣壓和高度，這在戶外導航設備中特別有用。

- **溫濕度感測器**：
監測環境條件，對於在極端氣候條件下運作的裝置來說非常重要。

- **OLED 顯示器**：
顯示系統狀態、消息和其他關鍵資訊，增強用戶介面的友好性。

- **GPS 模組**：
雖然GPS通常使用串行通訊，但某些I2C接口的GPS模組也可用於簡化連接和設置。

## 新手入門指南

如果你剛開始接觸I2C通訊，以下是一些實用的建議：

1. **從簡單開始**：選擇一個簡單的I2C設備（如OLED顯示器或溫度感測器）進行學習
2. **使用現有庫**：大多數平台都有現成的I2C庫，如Arduino的Wire庫或ESP32的I2C庫
3. **理解地址**：了解如何確定設備地址，以及如何處理地址衝突
4. **使用邏輯分析儀**：如有條件，使用邏輯分析儀查看實際I2C信號波形，幫助理解通訊過程
5. **參考示例**：查閱具體設備的資料表和示例代碼，理解特定設備的通訊協議

:::spoiler 進階主題：I2C時序圖解
![I2C時序圖](https://i.imgur.com/vqq4i2W.png)
上圖顯示了完整的I2C通訊過程，包括起始條件、地址傳輸、數據傳輸和終止條件。
:::

---

I2C的使用使得Meshtastic裝置可以輕易擴展功能，連接多種感測器而不需要大量的連接線，這對於要保持裝置小巧和能效高的便攜式通訊設備來說非常關鍵。這種多功能性和靈活性是Meshtastic在野外和遠程通訊應用中大受歡迎的原因之一。

## 參考資源

- [NXP I2C總線規範](https://www.nxp.com/docs/en/user-guide/UM10204.pdf)
- [Arduino Wire庫文檔](https://www.arduino.cc/en/reference/wire)
- [Raspberry Pi I2C教程](https://www.raspberrypi.org/documentation/hardware/raspberrypi/i2c/README.md)
- [ESP32 I2C通訊指南](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/i2c.html)